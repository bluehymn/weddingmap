<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <meta name="theme-color" content="#000000">
    <title>线路图</title>
    <style>
      .legend {
        position: absolute;
        background-color: rgba(255, 255, 255, 0.9);
        bottom: 0;
        right: 0;
        padding:15px;
      }

      .legend .line1,.legend .line2 {
        padding-bottom: 5px;
      }

      .legend .name {
        font-size: 12px;
      }

      .legend .line {
        display: inline-block;
        margin-left: 5px;
        height: 5px;
        width: 20px;
      }

      .legend .line1 .line {
        background-color: #00aefd;
      }

      .legend .line2 .line {
        background-color: #ff0000;
      }

      .legend .line3 .line {
        background-color: #ff9900;
      }


    </style>
  </head>
  <body>
    <div id="map" style="position:absolute;left:0;top:0;width:100%; height:100%">
    </div>
    <div class="legend">
      <div class="line1">
        <input type="checkbox" id="line1-checkbox" checked/><span class="name">接亲去行</span><div class="line"></div>
      </div>
      <div class="line2">
        <input type="checkbox" id="line2-checkbox" checked/><span class="name">接亲回程</span><div class="line"></div>
      </div>
      <div class="line3">
        <input type="checkbox" id="line3-checkbox" checked/><span class="name">前往酒店</span><div class="line"></div>
      </div>
    </div>
    <script charset="utf-8" src="http://map.qq.com/api/js?v=2.exp&key=MGUBZ-AW4H6-5MNST-M6O4C-TC76T-YSBIS&libraries=drawing,geometry,autocomplete,convertor"></script>
    <script charset="utf-8" src="./zepot.js"></script>
    <script>
      var map, clipboardText
      var path1 = [
        // 融侨城
        [114.34777915477753,30.60768454159257],
        // 铁机路口
        [114.34965133666992,30.60612397836856],
        // 铁四院掉头点1
        [114.34572458267212,30.60243023741825],
        // 铁四院掉头点2
        [114.34585869312286,30.602351743894705],
        // 花店
        [114.34599816799164,30.602347126626633],
        [114.34988737106323,30.606160915066763],
        // 二七长江大桥上桥点
        [114.35805201530457,30.612518434362563],
        [114.36026751995087,30.612698488744297],
        [114.36099708080292,30.613224799632796],
        [114.36097025871277,30.61405119429069],
        [114.36025679111481,30.615168431720967],
        [114.35929119586945,30.61626718984319],
        [114.35830414295197,30.617195122914932],
        [114.35638904571533,30.61911559296108],
        [114.35248374938965,30.621922365267235],
        [114.33261394500732,30.636028856572608],
        [114.32953476905823,30.637164302762326],
        [114.32724952697754,30.636988909505742],
        [114.32315111160278,30.635641140187317],
        [114.32259321212769,30.63479185124713],
        [114.32260930538177,30.6346856896054],
        [114.32429373264313,30.633716382271672],
        [114.32686865329742,30.636504268590915],
        // 解放大道百步亭花园路口
        [114.32847797870636,30.639933627820266],
        [114.32645559310913,30.640570561369064],
        [114.3198573589325,30.644355152472325],
        [114.31917071342468,30.645121283378437],
        [114.3191921710968,30.64513051383429],
        // 百步亭花园路兴业路口
        [114.31765794754028,30.64833342881643],
        // 百步亭花园路后湖大道路口
        [114.31532979011536,30.65450820177784],
        [114.30410742759705,30.6502163610175],
        [114.30172562599182,30.6492379792541],
        [114.29309964179993,30.64455822390607],
        // 后湖大道掉头位置
        [114.2903745174408,30.6430028704602],
        [114.29036378860474,30.642924409831352],
        // 世纪家园北门
        [114.2925363779068,30.644045929242857],
        // 小区第一个路口
        [114.292933344841,30.643492094121868],
        [114.29303526878357,30.643353634846047],
        [114.29303526878357,30.643353634846047],
        // 终点 新娘家
        [114.29373800754547,30.643436710435335]
      ];

      var path2 = [
        [114.29383993148804,30.64354747777667],
        [114.29402232170105,30.64373670502467],
        [114.29400622844696,30.64399054587349],
        [114.29292261600494,30.643501324733187],
        [114.29301381111145,30.643358250158435],
        [114.29363071918488,30.642522875028554],
        [114.29323375225067,30.642333645405653],
        [114.29286360740662,30.641793646641162],
        [114.29321229457855,30.641521338428408],
        [114.29337859153748,30.641152105728942],
        [114.2933464050293,30.640962873424172],
        // 世纪家园南门
        [114.29346978664398,30.640676716552765],
        // 后湖南路后湖三路口
        [114.29255247116089,30.64018747865038],
        // 后湖三路兴业路口
        [114.29398477077484,30.63721507443514],
        // 兴业路金桥大道路口
        [114.28597569465637,30.633808697674233],
        [114.28259611129761,30.63251165819328],
        [114.28266048431396,30.6323547198527],
        [114.28551435470581,30.633407125031308],

        [114.28579330444336,30.632243939694312],
        [114.28802490234375,30.62506142209331],
        [114.3092679977417,30.6126892551944],
        [114.34338569641113,30.590156771775625],
        [114.35441493988037,30.60164529932085],
        [114.34777915477753,30.60768454159257],
        [114.34692084789276,30.606664176176185],
        [114.34623956680298,30.607079710901125],
        [114.34599280357361,30.606765751495796],
        [114.34555292129517,30.606835007334467],
        [114.34548318386078,30.606719580909186]
      ];

      var path3 = [
        [114.34559047222137,30.606691878546656],
        [114.34579968452454,30.606488727645935],
        [114.3455958366394,30.606188617581147],
        [114.34620201587677,30.60585618688543],
        [114.34784889221191,30.607716860683496],
        [114.34958159923553,30.606225554254692],
        [114.34966742992401,30.60629481047961],
        // 铁机路沿江大道口
        [114.34384167194366,30.611202642179485],
        [114.34231281280518,30.609245079671872],
        [114.33958768844604,30.606918114275476],
        [114.330575466156,30.596399902671457],
        [114.3265950679779,30.59183765427464],
        [114.3218207359314,30.58536332587456],
        [114.31599497795105,30.57743838101956],
        [114.31446075439453,30.57639460457767],
        [114.3134093284607,30.575286157117766],
        [114.31097388267517,30.570796815344785],
        [114.30934309959412,30.567859232335664],
        [114.307701587677,30.565425035621075],
        [114.30565774440765,30.562385668216802]
      ]

      // 去行
      var route1 = {
        points: {},
        path: null
      }

      // 回行
      var route2 = {
        points: {},
        path: null
      }

      // 去酒店
      var route3 = {
        points: {},
        path: null
      }

      init();

      function init() {
        var myLatlng = new qq.maps.LatLng(30.603048948847825, 114.3233871459961);
        var myOptions = {
          zoom: 13,
          center: myLatlng,
          mapTypeId: qq.maps.MapTypeId.ROADMAP
        }
        map = new qq.maps.Map(document.getElementById("map"), myOptions);

        addEvent();
        initLegend();

        route1.path = drawLine(parsePath(path1), '#00aefd');
        var rongqiao = drawMarkerLabel([114.34777915477753, 30.60768454159257], '起点 融侨城');
        var flowershop = drawMarkerLabel([114.34599816799164,30.602347126626633], '花店');
        var wife = drawMarkerLabel([114.29373800754547,30.643436710435335], '新娘家');
        route1.points = {rongqiao: rongqiao, flowershop: flowershop, wife: wife};
        
        route2.path = drawLine(parsePath(path2), '#ff0000');
        var home = drawMarkerLabel([114.34548318386078,30.606719580909186], '新房 融侨城');
        route2.points = {home: home}

        route3.path = drawLine(parsePath(path3), '#ff9900');
        var hujin = drawMarkerLabel([114.30565774440765,30.562385668216802], '湖锦酒楼');
        route3.points = {hujin: hujin}

        addMarkerClickEvent([rongqiao,flowershop,wife,home,hujin])
      }

      function addMarkerClickEvent (markers) {
        if (!(markers instanceof Array)) {
          markers = Array(markers)
        }
        markers.forEach(function(marker){
          qq.maps.event.addListener(marker.marker, 'click', function(){
            map.setCenter(marker.pos)
          })
        })
      }
      
      function addEvent() {
        qq.maps.event.addListener(
          map,
          'click',
          function(event) {
            console.log('您点击的位置为:[' + event.latLng.getLng() + ',' + event.latLng.getLat() + ']');
            clipboardText = '[' + event.latLng.getLng() + ',' + event.latLng.getLat() + ']';
          }
        );
      }

      document.addEventListener('copy', function(e){
          e.clipboardData.setData('text/plain', clipboardText);
          e.preventDefault(); 
      });

      function drawLine(path, color) {
        return new qq.maps.Polyline({
          path: path,
          strokeColor: color,
          strokeWeight: 4,
          map
        });
      }

      function drawMarkerLabel (pos, name) {
        var marker = new qq.maps.Marker({
          position: createPos(pos),
          map: map
        });

        var label = new qq.maps.Label({
          position: createPos(pos),
          map: map,
          content: name,
          style: {
            backgroundColor: '#ff9000',
            color: '#fff',
            borderColor: '#ff6000' 
          }
        });

        return {marker: marker, label: label, pos: createPos(pos)}
      }

      function createPos (pos) {
        return new qq.maps.LatLng(pos[1], pos[0])
      }

      function parsePath (path) {
        return path.map(function(item){
          return createPos(item)
        })
      }

      function initLegend() {
        document.getElementById('line1-checkbox').addEventListener('change', function(e){
          if (this.checked) {
            route1.path.setVisible(true)
          } else {
            route1.path.setVisible(false)
          }
        })
        document.getElementById('line2-checkbox').addEventListener('change', function(e){
          if (this.checked) {
            route2.path.setVisible(true)
          } else {
            route2.path.setVisible(false)
          }
        })
        document.getElementById('line3-checkbox').addEventListener('change', function(e){
          if (this.checked) {
            route3.path.setVisible(true)
          } else {
            route3.path.setVisible(false)
          }
        })
      }



    </script>
  </body>
</html>